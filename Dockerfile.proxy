FROM bellsoft/liberica-runtime-container:jdk-23-musl AS build-image

WORKDIR /srv
COPY . ./
RUN ./gradlew --no-daemon :proxy:build


FROM bellsoft/liberica-runtime-container:jre-23-slim-musl
WORKDIR /srv
COPY --from=build-image /srv/proxy/build/libs/proxy-all.jar srv.jar
RUN chown -R 1000:1000 /srv
USER 1000:1000

CMD ["sh", "-c", "exec java -jar srv.jar"]
